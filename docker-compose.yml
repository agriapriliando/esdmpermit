services:
    ####################################################################################################
    # FrankenPHP (ganti PHP + Nginx)
    ####################################################################################################
    frankenphp:
        build:
            context: .docker/php
            dockerfile: Dockerfile
        # jika image sudah dibuat, jadi saat build ulang tidak membuat duplikat
        # image: esdmpermit-frankenphp:latest
        container_name: frankenphp
        command: frankenphp run --config /etc/frankenphp/Caddyfile
        ports:
            - "80:80"
            - "443:443"
        volumes:
            - .:/app
            - ./.docker/php/php.ini:/usr/local/etc/php/conf.d/uploads.ini
            - ./.docker/caddy_data:/data
            - ./.docker/caddy_config:/config
            - ./.docker/Caddyfile:/etc/frankenphp/Caddyfile
        extra_hosts:
            - "host.docker.internal:host-gateway"

    ####################################################################################################
    # Laravel Queue Worker
    ####################################################################################################
    queue:
        build:
            context: .docker/php
            dockerfile: Dockerfile
        # jika image sudah dibuat, jadi saat build ulang tidak membuat duplikat
        # image: esdmpermit-queue:latest
        container_name: queue
        working_dir: /app
        command: ["/usr/bin/supervisord", "-c", "/etc/supervisor/conf.d/supervisord.conf"]
        volumes:
            - .:/app
            - ./.docker/php/php.ini:/usr/local/etc/php/conf.d/uploads.ini
        extra_hosts:
            - "host.docker.internal:host-gateway"
        env_file:
            - .env
        restart: always

